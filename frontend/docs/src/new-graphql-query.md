# Adding a new GraphQL query

## Instructions

A new GraphQL query / mutation can be written in the same file as the component that needs it or in a separate `queries.graphql` / `mutations.graphql` file, in order for hooks to automatically get generated by the [codegen](./getting-started.html#codegen).

See [here](https://graphql.org/learn/queries/) for more information about how to write GraphQL queries and mutations.

## Example of how to add and use a query

### Writing the query

The `gql` template literal is imported from the `@apollo/client` package. It is used to define GraphQL queries in the code. In the `GithubRepoDetails` component, the `gql` template literal is used to define the `GetGithubRepositoryDetails` query.

Here's an example of how the `gql` template literal is used to define the query:

```typescript
import { gql } from '@apollo/client';

const GetGithubRepositoryDetails = gql`
  query GetGithubRepositoryDetails($githubRepoId: bigint) {
    githubReposByPk(githubRepoId: $githubRepoId) {
      ...GithubRepo
    }
  }

  fragment GithubRepo on GithubRepo {
    name
    description
    // ... other repository fields
  }
`;
```

The `GetGithubRepositoryDetails` query fetches the details of a GitHub repository based on the `githubRepoId` variable. It includes the `...GithubRepo` fragment, which specifies the fields to be fetched for the repository.

The `gql` template literal allows for writing GraphQL queries in a readable and type-safe manner within JavaScript or TypeScript code. It also enables tools like Apollo Client to parse and validate the queries at build time.

In the above example, the query is written inside the component, but *ideally the query should be written in a `queries.graphql` or `mutations.graphql` file, colocated with the relevant component*, just writing what is in the `gql` tag with the relevant fragments defined before being used, i.e.:

```typescript
fragment GithubRepo on GithubRepo {
  name
  description
  // ... other repository fields
}

query GetGithubRepositoryDetails($githubRepoId: bigint) {
  githubReposByPk(githubRepoId: $githubRepoId) {
	...GithubRepo
  }
}
```

### Hook

The `useGetGithubRepositoryDetailsQuery` hook is used to fetch details of a GitHub repository. It is imported from the `src/__generated/graphql` file. This hook is generated by Apollo Client based on the query added to a `queries.graphql file` 

To use the hook, the `githubRepoId` prop is passed as a variable to the query. The query itself is defined using the `gql` template literal tag. It is a GraphQL query named `GetGithubRepositoryDetails` that takes a single variable `githubRepoId` of type `bigint`. The query fetches the details of a GitHub repository with the given ID and includes the `...GithubRepo` fragment.

Here's an example of how the `useGetGithubRepositoryDetailsQuery` hook is used in the `GithubRepoDetails` component:

```typescript
import { useGetGithubRepositoryDetailsQuery } from 'src/__generated/graphql';

const GithubRepoDetails: React.FC<{ githubRepoId: number }> = ({ githubRepoId }) => {
  const { data } = useGetGithubRepositoryDetailsQuery({
    variables: { githubRepoId },
  });

  // Render the fetched data
  if (data?.githubReposByPk) {
    return <View {...data.githubReposByPk} />;
  }

  return null;
};
```

### Using query results

The `View` component is imported from the local directory. It is used to render the fetched repository details in the `GithubRepoDetails` component. The `View` component likely contains the UI elements and layout for displaying the repository details.

The `View` component receives the fetched repository details as props. In the example code above, the fetched repository details are spread as props using the spread operator (`...data.githubReposByPk`). This allows the `View` component to access and render the specific details of the GitHub repository.

Here's an example of how the `View` component might be implemented:

```typescript
type ViewProps = {
  name: string;
  description: string;
  // ... other repository details
};

const View: React.FC<ViewProps> = ({ name, description }) => {
  return (
    <div>
      <h1>{name}</h1>
      <p>{description}</p>
      {/* Render other repository details */}
    </div>
  );
};
```


